FROM node:14 as base

FROM base as builder
WORKDIR /build
COPY package*.json ./
RUN npm install

FROM base as development
WORKDIR /usr/src/app
RUN npm install -g nodemon
COPY --from=builder /build/node_modules ./node_modules
COPY /crystal-api .

FROM base as production
WORKDIR /usr/src/app
COPY --from=builder /build/node_modules ./node_modules
COPY /crystal-api .

EXPOSE 3000
ENTRYPOINT [ "node", "server.js" ]
